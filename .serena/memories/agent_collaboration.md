# エージェント連携

## エージェントシステムの概要

kokokitaプロジェクトでは、複数の専門エージェントが連携してタスクを遂行します。各エージェントは`.claude/commands/`に定義されています。

## 利用可能なエージェント

### 1. manager（プロジェクトマネージャー）
**役割**: プロジェクト全体の統括管理

**責務**:
- ユーザーからの要求を理解し、タスクに分割
- 技術的観点とサービスデザイン観点からの判断
- 実装方針とベストプラクティスの遵守確認
- 他のエージェントへのタスク委譲
- ドキュメント管理の統括

**使用方法**:
```
/manager [要求内容]
```

**参照ドキュメント**:
- CLAUDE.md
- doc/architecture-guide.md
- doc/implementation-guide.md

### 2. designer（設計エージェント）
**役割**: 詳細設計の作成

**責務**:
- 新機能や大きな変更の詳細設計
- UI/UXの設計
- データモデルの設計
- コンポーネント構成の設計
- 設計書の作成と更新

**使用方法**:
```
/designer [設計する機能の要件]
```

**呼び出しタイミング**:
- 新しい画面や大きな機能の追加
- 複数のコンポーネントにまたがる変更
- データモデルの大きな変更
- 外部サービスとの統合

### 3. reviewer（コードレビューエージェント）
**役割**: コードレビューと品質チェック

**責務**:
- 実装コードのレビュー
- アーキテクチャガイドへの準拠確認
- UIとロジックの分離確認
- パフォーマンスとセキュリティのチェック
- 改善提案

**使用方法**:
```
/reviewer [レビューするファイルまたはディレクトリ]
```

**呼び出しタイミング**:
- 重要な機能の実装完了後
- リファクタリング完了後
- プルリクエスト前

### 4. documentor（ドキュメント作成エージェント）
**役割**: ドキュメント作成の専門家

**責務**:
- ADRの作成
- 設計書の詳細化
- 技術ドキュメントの執筆
- ドキュメントの整合性確認

**使用方法**:
```
/documentor [作成または更新するドキュメントの内容]
```

**呼び出しタイミング**:
- 重要な技術的決定を記録する必要がある
- 複雑な設計を文書化する必要がある
- 既存ドキュメントの大幅な更新

## エージェント連携フロー

### 基本的な流れ
```
User → manager → 分析・計画
              ↓
              designer（設計が必要な場合）
              ↓
              実装
              ↓
              reviewer（レビューが必要な場合）
              ↓
              documentor（ドキュメント作成が必要な場合）
              ↓
              完了報告 → User
```

### 具体例: 新機能追加

1. **ユーザーが要求**: 「統計画面を追加したい」
2. **manager**: 要求を分析、影響範囲を調査
3. **designer**: 詳細設計を作成（UI、データモデル、コンポーネント構成）
4. **manager**: 設計に基づいて実装
5. **reviewer**: 実装コードをレビュー、改善提案
6. **manager**: レビュー結果に基づいて修正
7. **documentor**: 設計書やADRを作成/更新
8. **manager**: 完了報告

## エージェントの使い分け

### managerを使うべき時
- 要求が複雑で、タスク分割が必要
- 複数のエージェントの調整が必要
- プロジェクト全体の整合性を確認したい

### designerを直接使うべき時
- 設計だけが必要
- 実装は自分で行う
- 設計の妥当性を確認したい

### reviewerを直接使うべき時
- 実装済みコードのレビューだけが必要
- 特定のファイルやディレクトリだけをチェックしたい

### documentorを直接使うべき時
- ドキュメント作成だけが必要
- ADRや設計書の執筆に集中したい

## 共通ルール

### すべてのエージェントが従うルール

1. **CLAUDE.mdを最優先**: プロジェクト方針の最上位
2. **日本語でコミュニケーション**: コメント、ログ、ドキュメント
3. **アーキテクチャガイドを遵守**: Feature-based MV、@Observable使用
4. **実装チェックリストを確認**: タスク完了時の品質保証

### ドキュメント参照の優先順位

1. CLAUDE.md
2. doc/architecture-guide.md
3. doc/implementation-guide.md
4. doc/ADR/
5. doc/design/

## エージェント設計の原則

### 責務の分離
各エージェントは明確な責務を持ち、他のエージェントの領域には踏み込まない

### コンテキスト管理
- タスク開始時に必要な情報を渡す
- タスク完了時に結果を返す
- 中間状態はエージェント内で管理

### ドキュメント同期
- エージェントが作成・更新したドキュメントは常に最新に保つ
- ドキュメント間の整合性を確認
- 古い情報は削除または更新

## Serenaとの連携

このプロジェクトではSerena（MCPサーバー）も導入されています。Serenaは以下の機能を提供:

- シンボリック検索（find_symbol）
- 参照検索（find_referencing_symbols）
- コード編集（replace_symbol_body、insert_after_symbol等）
- メモリ管理（write_memory、read_memory）

エージェントはSerenaのツールを活用してコード解析や編集を効率的に行います。